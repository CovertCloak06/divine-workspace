<!DOCTYPE html>
<html>
<head>
    <title>PKN Plugin Debug</title>
    <style>
        body {
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
        }
        .status { padding: 10px; margin: 10px 0; border: 1px solid #0f0; }
        .error { color: #f00; border-color: #f00; }
        .success { color: #0f0; border-color: #0f0; }
        .info { color: #0ff; border-color: #0ff; }
    </style>
</head>
<body>
    <h1>PKN Plugin System Debug</h1>
    <div id="output"></div>

    <script type="module">
        const output = document.getElementById('output');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = msg;
            output.appendChild(div);
        }

        log('Starting debug checks...', 'info');

        // Check 1: Can we load plugin-manager?
        try {
            const { pluginManager } = await import('./js/plugin-manager.js');
            log('✅ Plugin Manager module loaded', 'success');

            await pluginManager.init();
            log('✅ Plugin Manager initialized', 'success');

            // Check 2: Can we load plugins?
            const plugins = [
                { name: 'Welcome Message', path: './plugins/welcome-message/plugin.js', manifest: './plugins/welcome-message/manifest.json', class: 'WelcomeMessagePlugin' },
                { name: 'Context Detector', path: './plugins/context-detector/plugin.js', manifest: './plugins/context-detector/manifest.json', class: 'SmartContextDetectorPlugin' },
                { name: 'Voice I/O', path: './plugins/voice-io/plugin.js', manifest: './plugins/voice-io/manifest.json', class: 'VoiceIOPlugin' },
                { name: 'Quick Actions', path: './plugins/quick-actions/plugin.js', manifest: './plugins/quick-actions/manifest.json', class: 'QuickActionsPlugin' },
                { name: 'Agent Memory', path: './plugins/agent-memory/plugin.js', manifest: './plugins/agent-memory/manifest.json', class: 'AgentMemoryPlugin' }
            ];

            for (const plugin of plugins) {
                try {
                    const manifestRes = await fetch(plugin.manifest);
                    const manifest = await manifestRes.json();

                    const module = await import(plugin.path);
                    const PluginClass = module[plugin.class] || module.default;

                    await pluginManager.register(manifest, PluginClass);
                    log(`✅ ${plugin.name} registered`, 'success');
                } catch (error) {
                    log(`❌ ${plugin.name} failed: ${error.message}`, 'error');
                    console.error(error);
                }
            }

            // Check 3: List registered plugins
            const registered = pluginManager.getAllPlugins();
            log(`\n✅ Total registered: ${registered.length} plugins`, 'success');

            registered.forEach(p => {
                log(`  - ${p.manifest.name} (${p.manifest.id})`, 'info');
            });

            // Check 4: Can we access from window?
            window.pluginManager = pluginManager;
            log('\n✅ Plugin Manager available at window.pluginManager', 'success');
            log('Try in console: pluginManager.getAllPlugins()', 'info');

        } catch (error) {
            log(`❌ Fatal error: ${error.message}`, 'error');
            console.error(error);
        }
    </script>
</body>
</html>
